#!/bin/bash

echo "Починаю оновлення проєкту..."

# Перехід до директорії проєкту
cd /root/dev/checkApp || { echo "Не вдалося перейти до директорії проєкту."; exit 1; }
echo "Перейшов до директорії проєкту: $(pwd)"

# Перевірка, чи ініціалізовано git
if [ ! -d ".git" ]; then
    echo "Директорія не є репозиторієм Git. Ініціалізуйте репозиторій або переконайтеся, що ви в правильній директорії."
    exit 1
fi

# Перевірка наявності віддаленого репозиторію
if ! git remote -v | grep -q 'origin'; then
    echo "Віддалений репозиторій не налаштовано. Будь ласка, додайте віддалений репозиторій."
    exit 1
fi

# Витягування останніх змін з репозиторію
echo "Витягаю останні зміни з репозиторію..."
if git pull origin main; then
    echo "Оновлення з репозиторію завершено."
else
    echo "Не вдалося витягнути зміни з репозиторію."
    exit 1
fi

# Встановлення нових залежностей (якщо є)
echo "Перевіряю нові залежності..."
if npm install; then
    echo "Установка залежностей завершена."
else
    echo "Не вдалося встановити залежності."
    exit 1
fi

# Перезапуск служби
echo "Перезапускаю службу checkApp..."
if sudo systemctl restart checkApp; then
    echo "Служба checkApp успішно перезапущена."
else
    echo "Не вдалося перезапустити службу checkApp."
    exit 1
fi

echo "Проєкт успішно оновлений та служба checkApp перезапущена."
